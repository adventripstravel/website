"use strict";$(document).ready(function(){$('[name="tour"]').on("change",function(){$.ajax({type:"POST",data:"id="+$(this).val()+"&action=get_tour_price",processData:false,cache:false,dataType:"json",success:function(c){if(c.status=="success"){$('[name="price_child"]').val(c.data.price.child);$('[name="price_adult"]').val(c.data.price.adult)}else{if(c.status=="error"){$('[data-modal="alert"]').addClass("view");$('[data-modal="alert"]').find("main > p").html(c.message)}}}});get_total()});$('[name="paxes_childs"]').on("change",function(){get_total()});$('[name="paxes_adults"]').on("change",function(){get_total()});$('[name="payment_currency"]').on("change",function(){get_total()});$('[name="booked_date"]').on("change",function(){$('[name="payment_date"]').attr("min",$(this).val())});var b=null;var a=false;$('[data-modal="create_booking"]').modal().onCancel(function(){b=null;a=false;$('[data-modal="create_booking"]').find("header > h3").html("Crear");$('[data-modal="create_booking"]').find("form")[0].reset();$('[data-modal="create_booking"]').find('[name="token"]').parents("fieldset").addClass("hidden");$('[data-modal="create_booking"]').find('[name="request_type"]').parents("fieldset").addClass("hidden");$('[data-modal="create_booking"]').find('[name="request_details"]').parents("fieldset").addClass("hidden");$('[data-modal="create_booking"]').find('[name="language"]').parent().parent().removeClass("span4");$('[data-modal="create_booking"]').find('[name="language"]').parent().parent().addClass("span12");$('[data-modal="create_booking"]').find('[name="registration_date"]').parent().parent().addClass("hidden");$('[data-modal="create_booking"]').find('[name="status"]').parent().parent().addClass("hidden");$('[data-modal="create_booking"]').find("label.error").removeClass("error");$('[data-modal="create_booking"]').find("p.error").remove()});$('[data-modal="create_booking"]').modal().onSuccess(function(){$('[data-modal="create_booking"]').find("form").submit()});$('form[name="create_booking"]').on("submit",function(f){f.preventDefault();var c=$(this);if(a==false){var d="&action=create_booking"}else{if(a==true){var d="&id="+b+"&action=update_booking"}}$.ajax({url:"",type:"POST",data:c.serialize()+d,processData:false,cache:false,dataType:"json",success:function(e){checkFormDataErrors(c,e,function(){$('[data-modal="create_booking"]').removeClass("view");$('[data-modal="success"]').addClass("view");$('[data-modal="success"]').find("main > p").html(e.message);setTimeout(function(){location.reload()},1500)})}})});$(document).on("click",'[data-action="update_booking"]',function(){b=$(this).data("id");a=true;$.ajax({type:"POST",data:"id="+b+"&action=get_booking",processData:false,cache:false,dataType:"json",success:function(e){if(e.status=="success"){$('[data-modal="create_booking"]').addClass("view");$('[data-modal="create_booking"]').find("header > h3").html("Ver detalles | Actualizar");$('[data-modal="create_booking"]').find('[name="token"]').parents("fieldset").removeClass("hidden");$('[data-modal="create_booking"]').find('[name="token"]').val(e.data.token);$('[data-modal="create_booking"]').find('[name="tour"]').val(e.data.tour);$('[data-modal="create_booking"]').find('[name="price_child"]').val(e.data.price.child);$('[data-modal="create_booking"]').find('[name="price_adult"]').val(e.data.price.adult);$('[data-modal="create_booking"]').find('[name="paxes_childs"]').val(e.data.paxes.childs);$('[data-modal="create_booking"]').find('[name="paxes_adults"]').val(e.data.paxes.adults);$('[data-modal="create_booking"]').find('[name="total"]').val(e.data.total);$('[data-modal="create_booking"]').find('[name="payment_currency"]').val(e.data.payment.currency);$('[data-modal="create_booking"]').find('[name="payment_exchange"]').val(e.data.payment.exchange);$('[data-modal="create_booking"]').find('[name="firstname"]').val(e.data.firstname);$('[data-modal="create_booking"]').find('[name="lastname"]').val(e.data.lastname);$('[data-modal="create_booking"]').find('[name="email"]').val(e.data.email);$('[data-modal="create_booking"]').find('[name="phone_lada"]').val(e.data.phone.lada);$('[data-modal="create_booking"]').find('[name="phone_number"]').val(e.data.phone.number);$('[data-modal="create_booking"]').find('[name="observations"]').val(e.data.observations);$('[data-modal="create_booking"]').find('[name="payment_date"]').val(e.data.payment.date);$('[data-modal="create_booking"]').find('[name="payment_method"]').val(e.data.payment.method);if(e.data.payment.status==true){$('[data-modal="create_booking"]').find('[name="payment_status"]').val("1")}else{if(e.data.payment.status==false){$('[data-modal="create_booking"]').find('[name="payment_status"]').val("0")}}if(e.data.request.type=="update"||e.data.request.type=="cancel"){$('[data-modal="create_booking"]').find('[name="request_type"]').parents("fieldset").removeClass("hidden");if(e.data.request.type=="update"){$('[data-modal="create_booking"]').find('[name="request_type"]').val("Actualización")}else{if(e.data.request.type=="cancel"){$('[data-modal="create_booking"]').find('[name="request_type"]').val("Cancelación")}}$('[data-modal="create_booking"]').find('[name="request_details"]').parents("fieldset").removeClass("hidden");$('[data-modal="create_booking"]').find('[name="request_details"]').val(e.data.request.details)}$('[data-modal="create_booking"]').find('[name="language"]').parent().parent().removeClass("span12");$('[data-modal="create_booking"]').find('[name="language"]').parent().parent().addClass("span4");$('[data-modal="create_booking"]').find('[name="language"]').val(e.data.language);$('[data-modal="create_booking"]').find('[name="registration_date"]').parent().parent().removeClass("hidden");$('[data-modal="create_booking"]').find('[name="registration_date"]').val(e.data.registration_date);$('[data-modal="create_booking"]').find('[name="status"]').parent().parent().removeClass("hidden");if(e.data.canceled==true){$('[data-modal="create_booking"]').find('[name="status"]').val("Cancelada")}else{if(e.data.canceled==false){var f=new Date();var c=["01","02","03","04","05","06","07","08","09","10","11","12"];var d=f.getFullYear()+"-"+c[f.getMonth()]+"-"+f.getDate();if(e.data.booked_date>=d){$('[data-modal="create_booking"]').find('[name="status"]').val("Activa")}else{if(e.data.booked_date<d){$('[data-modal="create_booking"]').find('[name="status"]').val("Terminada")}}}}}else{if(e.status=="error"){$('[data-modal="error"]').addClass("view");$('[data-modal="error"]').find("main > p").html(e.message)}}}})})});function get_total(){var a=$('form[name="create_booking"]');$.ajax({type:"POST",data:"tour="+$('[name="tour"]').val()+"&paxes_childs="+$('[name="paxes_childs"]').val()+"&paxes_adults="+$('[name="paxes_adults"]').val()+"&payment_currency="+$('[name="payment_currency"]').val()+"&action=get_total",processData:false,cache:false,dataType:"json",success:function(b){checkFormDataErrors(a,b,function(){$('[name="total"]').val(b.data.total)})}})};